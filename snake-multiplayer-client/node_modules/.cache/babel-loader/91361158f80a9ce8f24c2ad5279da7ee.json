{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\victo\\\\Desktop\\\\code\\\\Projects\\\\snake-multiplayer\\\\snake-multiplayer-client\\\\src\\\\pages\\\\InGame\\\\index.js\";\nimport React, { useState, useRef, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport UIfx from 'uifx';\nimport GameOver from './assets/gameOver.mp3';\nimport Point from './assets/point.wav';\nimport Hit from './assets/hit.wav';\nimport Modal from 'react-modal';\nimport { useInterval } from './useInterval.js';\nimport { compass } from './constants.js';\nimport './InGame.css';\nimport api from '../../services/api';\n\nconst InGame = () => {\n  const data = useLocation().state;\n  const map = data.map;\n  const myColor = data.myColor;\n  const gameOverSound = new UIfx(GameOver);\n  const pointSound = new UIfx(Point);\n  const hitSound = new UIfx(Hit);\n  const canvasRef = useRef();\n  const [modalOpen, setModalOpen] = useState(true);\n  const [gameOverModal, setGameOverModal] = useState(false);\n  const [snakes, setSnakes] = useState([]);\n  const [snake, setSnake] = useState(data.myPosition);\n  const [apple, setApple] = useState([-1, -1]);\n  const [momentum, setMomentum] = useState(compass[Object.keys(compass)[8 * Math.random() << 0]]);\n  const [syncMomentum, setSyncMomentum] = useState(momentum);\n  const [snakeSpeed, setSnakeSpeed] = useState(null);\n  const [gameOver, setGameOver] = useState(false);\n  const [searching, setSearching] = useState(false);\n  const [running, setRunning] = useState(false);\n  useEffect(() => {\n    api.get('apple').then(response => setApple(response.data));\n  });\n  useEffect(() => {\n    api.get('snakes').then(response => {\n      setSnakes(response.data);\n\n      for (const player of snakes) {\n        if (player.color === myColor) setSnake(player);\n      }\n    });\n  });\n  useEffect(() => {\n    const context = canvasRef.current.getContext('2d');\n    context.setTransform(map.scale, 0, 0, map.scale, 0, 0);\n  });\n\n  const startGame = () => {\n    setGameOver(false);\n    setSearching(null);\n    setSnakeSpeed(100);\n  };\n\n  const move = keyCode => {\n    if (keyCode in compass) {\n      const newMomentum = compass[keyCode];\n      if (newMomentum.map(Math.abs)[0] !== momentum.map(Math.abs)[0] && newMomentum.map(Math.abs)[1] !== momentum.map(Math.abs)[1]) setMomentum(newMomentum);\n    } else if (keyCode === 13 || keyCode === 32) startGame();\n  };\n\n  const endGame = () => {\n    setGameOverModal(true);\n    hitSound.play();\n    gameOverSound.play();\n    setSearching(1000);\n    setSnakeSpeed(null);\n    setGameOver(true);\n  };\n\n  const wrapAdjust = (value, index) => {\n    if (value >= map.size[index] / map.scale) return 0;else if (value < 0) return map.size[index] / map.scale - 1;else return value;\n  };\n\n  const spawnApple = () => apple.map((_, i) => Math.floor(Math.random() * map.size[i] / map.scale));\n\n  const checkCollision = (head, snek = snake) => {\n    for (const segment of snek) {\n      if (head[0] === segment[0] && head[1] === segment[1]) return true;\n    }\n\n    return false;\n  };\n\n  const checkAppleCollision = snek => {\n    if (snek[0][0] === apple[0] && snek[0][1] === apple[1]) {\n      pointSound.play();\n      let newApple = spawnApple();\n\n      while (checkCollision(newApple, snek)) spawnApple();\n\n      setApple(newApple);\n      return true;\n    }\n\n    return false;\n  };\n\n  const gameOn = () => {\n    setSyncMomentum(momentum);\n    let i = 0;\n\n    for (const player of snakes) {\n      if (player.color === myColor) {\n        const snakeCopy = JSON.parse(JSON.stringify(snake));\n        const newSnakeHead = [wrapAdjust(snakeCopy[0][0] + syncMomentum[0], 0), wrapAdjust(snakeCopy[0][1] + syncMomentum[1], 1)];\n        snakeCopy.unshift(newSnakeHead);\n        if (checkCollision(newSnakeHead)) endGame();\n        if (!checkAppleCollision(snakeCopy)) snakeCopy.pop();\n        setSnake(snakeCopy);\n      }\n    }\n\n    const snakeCopy = JSON.parse(JSON.stringify(snake));\n    const newSnakeHead = [wrapAdjust(snakeCopy[0][0] + syncMomentum[0], 0), wrapAdjust(snakeCopy[0][1] + syncMomentum[1], 1)];\n    snakeCopy.unshift(newSnakeHead);\n    if (checkCollision(newSnakeHead)) endGame();\n    if (!checkAppleCollision(snakeCopy)) snakeCopy.pop();\n    setSnake(snakeCopy);\n  };\n\n  useEffect(() => {\n    const context = canvasRef.current.getContext('2d');\n    context.clearRect(0, 0, map.size[0], map.size[1]);\n    context.fillStyle = '#ff353a';\n    context.fillRect(apple[0], apple[1], 1, 1);\n    api.get('snakes').then(response => {\n      for (const player of response.data) {\n        context.fillStyle = player.color;\n        player.position.forEach(([x, y]) => context.fillRect(x, y, 1, 1));\n      }\n    });\n  }, [snake, apple, gameOver, map, myColor, snakes]);\n  useInterval(() => {\n    if (searching) {\n      api.get('running').then(response => setRunning(response.data));\n      if (running === true) startGame();\n    }\n  }, searching);\n  useInterval(() => {\n    api.get('snakes').then(response => {\n      setSnakes(response.data);\n      gameOn();\n    });\n  }, snakeSpeed);\n  const element = document.getElementById('root');\n\n  function openFullscreen() {\n    if (element.requestFullscreen) {\n      element.requestFullscreen();\n    } else if (element.mozRequestFullScreen) {\n      element.mozRequestFullScreen();\n    } else if (element.webkitRequestFullscreen) {\n      element.webkitRequestFullscreen();\n    } else if (element.msRequestFullscreen) {\n      element.msRequestFullscreen();\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"keyCap\",\n    role: \"button\",\n    tabIndex: \"-1\",\n    onKeyDown: event => move(event.keyCode),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Modal, {\n    className: \"gameOverModal\",\n    overlayClassName: \"modalOverlay\",\n    isOpen: gameOverModal,\n    onRequestClose: () => setGameOverModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"mainTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 5\n    }\n  }, \"Game Over!\")), /*#__PURE__*/React.createElement(Modal, {\n    className: \"modal\",\n    overlayClassName: \"modalOverlay\",\n    isOpen: modalOpen,\n    onRequestClose: () => setModalOpen(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 5\n    }\n  }, \"Would you like to enable fullscreen?\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 5\n    }\n  }, \"(Recommended)\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => {\n      setModalOpen(false);\n      openFullscreen();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 5\n    }\n  }, \"Ok\")), /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"mainTitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 4\n    }\n  }, \"Snake Multiplayer\"), /*#__PURE__*/React.createElement(\"canvas\", {\n    className: \"map\",\n    ref: canvasRef,\n    width: `${map.size[0]}px`,\n    height: `${map.size[1]}px`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 4\n    }\n  }));\n};\n\nexport default InGame;","map":{"version":3,"sources":["C:/Users/victo/Desktop/code/Projects/snake-multiplayer/snake-multiplayer-client/src/pages/InGame/index.js"],"names":["React","useState","useRef","useEffect","useLocation","UIfx","GameOver","Point","Hit","Modal","useInterval","compass","api","InGame","data","state","map","myColor","gameOverSound","pointSound","hitSound","canvasRef","modalOpen","setModalOpen","gameOverModal","setGameOverModal","snakes","setSnakes","snake","setSnake","myPosition","apple","setApple","momentum","setMomentum","Object","keys","Math","random","syncMomentum","setSyncMomentum","snakeSpeed","setSnakeSpeed","gameOver","setGameOver","searching","setSearching","running","setRunning","get","then","response","player","color","context","current","getContext","setTransform","scale","startGame","move","keyCode","newMomentum","abs","endGame","play","wrapAdjust","value","index","size","spawnApple","_","i","floor","checkCollision","head","snek","segment","checkAppleCollision","newApple","gameOn","snakeCopy","JSON","parse","stringify","newSnakeHead","unshift","pop","clearRect","fillStyle","fillRect","position","forEach","x","y","element","document","getElementById","openFullscreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","event"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport UIfx from 'uifx';\nimport GameOver from './assets/gameOver.mp3';\nimport Point from './assets/point.wav';\nimport Hit from './assets/hit.wav';\nimport Modal from 'react-modal';\nimport { useInterval } from './useInterval.js';\nimport { compass } from './constants.js';\nimport './InGame.css';\n\nimport api from '../../services/api';\n\nconst InGame = () => {\n\tconst data = useLocation().state;\n\n\tconst map = data.map;\n\tconst myColor = data.myColor;\n\tconst gameOverSound = new UIfx(GameOver);\n\tconst pointSound = new UIfx(Point);\n\tconst hitSound = new UIfx(Hit);\n\tconst canvasRef = useRef();\n\tconst [modalOpen, setModalOpen] = useState(true);\n\tconst [gameOverModal, setGameOverModal] = useState(false);\n\tconst [snakes, setSnakes] = useState([]);\n\tconst [snake, setSnake] = useState(data.myPosition);\n\tconst [apple, setApple] = useState([-1, -1]);\n\tconst [momentum, setMomentum] = useState(\n\t\tcompass[Object.keys(compass)[(8 * Math.random()) << 0]]\n\t);\n\tconst [syncMomentum, setSyncMomentum] = useState(momentum);\n\tconst [snakeSpeed, setSnakeSpeed] = useState(null);\n\tconst [gameOver, setGameOver] = useState(false);\n\tconst [searching, setSearching] = useState(false);\n\tconst [running, setRunning] = useState(false);\n\n\tuseEffect(() => {\n\t\tapi.get('apple').then((response) => setApple(response.data));\n\t});\n\n\tuseEffect(() => {\n\t\tapi.get('snakes').then((response) => {\n\t\t\tsetSnakes(response.data)\n\t\t\tfor (const player of snakes) {\n\t\t\t\tif (player.color === myColor) setSnake(player);\n\t\t\t}\n\t\t});\n\t});\n\n\tuseEffect(() => {\n\t\tconst context = canvasRef.current.getContext('2d');\n\t\tcontext.setTransform(map.scale, 0, 0, map.scale, 0, 0);\n\t});\n\n\tconst startGame = () => {\n\t\tsetGameOver(false);\n\t\tsetSearching(null);\n\t\tsetSnakeSpeed(100);\n\t};\n\n\tconst move = (keyCode) => {\n\t\tif (keyCode in compass) {\n\t\t\tconst newMomentum = compass[keyCode];\n\t\t\tif (\n\t\t\t\tnewMomentum.map(Math.abs)[0] !== momentum.map(Math.abs)[0] &&\n\t\t\t\tnewMomentum.map(Math.abs)[1] !== momentum.map(Math.abs)[1]\n\t\t\t)\n\t\t\t\tsetMomentum(newMomentum);\n\t\t} else if (keyCode === 13 || keyCode === 32) startGame();\n\t};\n\n\tconst endGame = () => {\n\t\tsetGameOverModal(true);\n\t\thitSound.play();\n\t\tgameOverSound.play();\n\t\tsetSearching(1000);\n\t\tsetSnakeSpeed(null);\n\t\tsetGameOver(true);\n\t};\n\n\tconst wrapAdjust = (value, index) => {\n\t\tif (value >= map.size[index] / map.scale) return 0;\n\t\telse if (value < 0) return map.size[index] / map.scale - 1;\n\t\telse return value;\n\t};\n\n\tconst spawnApple = () =>\n\t\tapple.map((_, i) => Math.floor((Math.random() * map.size[i]) / map.scale));\n\n\tconst checkCollision = (head, snek = snake) => {\n\t\tfor (const segment of snek) {\n\t\t\tif (head[0] === segment[0] && head[1] === segment[1]) return true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst checkAppleCollision = (snek) => {\n\t\tif (snek[0][0] === apple[0] && snek[0][1] === apple[1]) {\n\t\t\tpointSound.play();\n\t\t\tlet newApple = spawnApple();\n\t\t\twhile (checkCollision(newApple, snek)) spawnApple();\n\t\t\tsetApple(newApple);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst gameOn = () => {\n\t\tsetSyncMomentum(momentum);\n\t\tlet i = 0;\n\t\tfor (const player of snakes) {\n\t\t\tif (player.color === myColor) {\n\t\t\t\tconst snakeCopy = JSON.parse(JSON.stringify(snake));\n\t\t\t\tconst newSnakeHead = [\n\t\t\t\t\twrapAdjust(snakeCopy[0][0] + syncMomentum[0], 0),\n\t\t\t\t\twrapAdjust(snakeCopy[0][1] + syncMomentum[1], 1),\n\t\t\t\t];\n\t\t\t\tsnakeCopy.unshift(newSnakeHead);\n\t\t\t\tif (checkCollision(newSnakeHead)) endGame();\n\t\t\t\tif (!checkAppleCollision(snakeCopy)) snakeCopy.pop();\n\t\t\t\tsetSnake(snakeCopy);\n\t\t\t}\n\t\t}\n\t\tconst snakeCopy = JSON.parse(JSON.stringify(snake));\n\t\tconst newSnakeHead = [\n\t\t\twrapAdjust(snakeCopy[0][0] + syncMomentum[0], 0),\n\t\t\twrapAdjust(snakeCopy[0][1] + syncMomentum[1], 1),\n\t\t];\n\t\tsnakeCopy.unshift(newSnakeHead);\n\t\tif (checkCollision(newSnakeHead)) endGame();\n\t\tif (!checkAppleCollision(snakeCopy)) snakeCopy.pop();\n\t\tsetSnake(snakeCopy);\n\t};\n\n\tuseEffect(() => {\n\t\tconst context = canvasRef.current.getContext('2d');\n\t\tcontext.clearRect(0, 0, map.size[0], map.size[1]);\n\t\tcontext.fillStyle = '#ff353a';\n\t\tcontext.fillRect(apple[0], apple[1], 1, 1);\n\t\tapi.get('snakes').then((response) => {\n\t\t\tfor (const player of response.data) {\n\t\t\t\tcontext.fillStyle = player.color;\n\t\t\t\tplayer.position.forEach(([x, y]) => context.fillRect(x, y, 1, 1));\n\t\t\t}\n\t\t});\n\t}, [snake, apple, gameOver, map, myColor, snakes]);\n\n\tuseInterval(() => {\n\t\tif (searching) {\n\t\t\tapi.get('running').then((response) => setRunning(response.data));\n\t\t\tif (running === true) startGame();\n\t\t}\n\t}, searching);\n\n\tuseInterval(() => {\n\t\tapi.get('snakes').then((response) => {\n\t\t\tsetSnakes(response.data);\n\t\t\tgameOn();\n\t\t});\n\t}, snakeSpeed);\n\n\tconst element = document.getElementById('root');\n\n\tfunction openFullscreen() {\n\t\tif (element.requestFullscreen) {\n\t\t\telement.requestFullscreen();\n\t\t} else if (element.mozRequestFullScreen) {\n\t\t\telement.mozRequestFullScreen();\n\t\t} else if (element.webkitRequestFullscreen) {\n\t\t\telement.webkitRequestFullscreen();\n\t\t} else if (element.msRequestFullscreen) {\n\t\t\telement.msRequestFullscreen();\n\t\t}\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"keyCap\"\n\t\t\trole=\"button\"\n\t\t\ttabIndex=\"-1\"\n\t\t\tonKeyDown={(event) => move(event.keyCode)}\n\t\t>\n\t\t\t<Modal\n\t\t\t\tclassName=\"gameOverModal\"\n\t\t\t\toverlayClassName=\"modalOverlay\"\n\t\t\t\tisOpen={gameOverModal}\n\t\t\t\tonRequestClose={() => setGameOverModal(false)}\n\t\t\t>\n\t\t\t\t<h1 className=\"mainTitle\">Game Over!</h1>\n\t\t\t</Modal>\n\t\t\t<Modal\n\t\t\t\tclassName=\"modal\"\n\t\t\t\toverlayClassName=\"modalOverlay\"\n\t\t\t\tisOpen={modalOpen}\n\t\t\t\tonRequestClose={() => setModalOpen(false)}\n\t\t\t>\n\t\t\t\t<h2>Would you like to enable fullscreen?</h2>\n\t\t\t\t<p>(Recommended)</p>\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tsetModalOpen(false);\n\t\t\t\t\t\topenFullscreen();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\tOk\n\t\t\t\t</button>\n\t\t\t</Modal>\n\t\t\t<h1 className=\"mainTitle\">Snake Multiplayer</h1>\n\t\t\t<canvas\n\t\t\t\tclassName=\"map\"\n\t\t\t\tref={canvasRef}\n\t\t\t\twidth={`${map.size[0]}px`}\n\t\t\t\theight={`${map.size[1]}px`}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n\nexport default InGame;\n"]},"metadata":{},"sourceType":"module"}